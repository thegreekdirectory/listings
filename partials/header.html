<!-- partials/header.html -->
<!-- Copyright (C) The Greek Directory, 2025-present. All rights reserved. -->

<header id="listingsHeader" class="bg-white border-b border-gray-200 fixed top-0 left-0 right-0 z-40">
    <div class="max-w-7xl mx-auto px-4">
        <div class="flex items-center justify-between h-14">
            <!-- Logo -->
            <a href="/" class="flex items-center gap-2 flex-shrink-0">
                <img src="https://static.thegreekdirectory.org/img/logo/blue.svg" alt="The Greek Directory" class="h-8 w-auto">
                <span class="text-sm font-semibold text-gray-900 hidden sm:inline">The Greek Directory</span>
            </a>

            <!-- Full nav (shown when everything fits) -->
            <nav id="headerFullNav" class="flex items-center gap-1">
                <a href="/" id="navHome" class="px-3 py-1.5 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg">Home</a>
                <a href="/listings" id="navListings" class="px-3 py-1.5 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg">Listings</a>
                <a href="/about" id="navAbout" class="px-3 py-1.5 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg">About</a>
                <a href="/listings?starred=1" id="headerStarBtn" class="px-2 py-1.5 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg" title="View Starred" onclick="if(window.location.pathname === '/listings' || window.location.pathname === '/listings.html') { event.preventDefault(); if(typeof toggleStarredView === 'function') toggleStarredView(); }">
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="#facc15" stroke="#ca8a04" stroke-width="1.5"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                </a>
            </nav>

            <!-- Hamburger mode: star icon stays in header, hamburger opens dropdown -->
            <div id="headerHamburgerRow" class="hidden items-center gap-2">
                <a href="/listings?starred=1" class="p-1.5 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg" style="touch-action:manipulation;-webkit-tap-highlight-color:transparent;" title="View Starred" onclick="if(window.location.pathname === '/listings' || window.location.pathname === '/listings.html') { event.preventDefault(); if(typeof toggleStarredView === 'function') toggleStarredView(); }">
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="#facc15" stroke="#ca8a04" stroke-width="1.5"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                </a>
                <button id="hamburgerBtn" class="p-1.5 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg" style="touch-action:manipulation;-webkit-tap-highlight-color:transparent;" aria-label="Menu">
                    <svg id="hamburgerIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
                    <svg id="hamburgerCloseIcon" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Hamburger dropdown panel -->
    <div id="hamburgerDropdown" class="hidden border-t border-gray-100 bg-white">
        <div class="max-w-7xl mx-auto px-4 py-3 flex flex-col gap-1">
            <a href="/" id="dropHome" class="px-3 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg" style="touch-action:manipulation;-webkit-tap-highlight-color:transparent;">Home</a>
            <a href="/listings" id="dropListings" class="px-3 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg" style="touch-action:manipulation;-webkit-tap-highlight-color:transparent;">Listings</a>
            <a href="/about" id="dropAbout" class="px-3 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg" style="touch-action:manipulation;-webkit-tap-highlight-color:transparent;">About</a>
        </div>
    </div>
</header>
<!-- Spacer to push content below the fixed header (h-14 = 56px) -->
<div style="height:56px;"></div>

<script>
(function initHeader() {
    // ── Active-tab highlighting ──
    var path = window.location.pathname;

    function isActive(href) {
        // Strip .html from both sides so /listings matches /listings.html and vice-versa
        var normPath = path.replace(/\.html$/, '');
        var hrefPath = href.split('?')[0].split('#')[0].replace(/\.html$/, '');
        if (hrefPath === '/') return normPath === '/';
        return normPath === hrefPath || normPath.startsWith(hrefPath + '/');
    }

    function applyActive(el, href) {
        if (!el) return;
        if (isActive(href)) {
            el.classList.remove('text-gray-600', 'hover:text-gray-900', 'hover:bg-gray-100');
            el.classList.add('font-semibold', 'text-white');
            el.style.backgroundColor = '#055193';
        }
    }

    applyActive(document.getElementById('navHome'),     '/');
    applyActive(document.getElementById('navListings'), '/listings');
    applyActive(document.getElementById('navAbout'),    '/about');
    applyActive(document.getElementById('dropHome'),     '/');
    applyActive(document.getElementById('dropListings'), '/listings');
    applyActive(document.getElementById('dropAbout'),    '/about');

    // ── Responsive hamburger ──
    var fullNav      = document.getElementById('headerFullNav');
    var hamburgerRow = document.getElementById('headerHamburgerRow');
    var hamburgerBtn = document.getElementById('hamburgerBtn');
    var hamburgerIcon      = document.getElementById('hamburgerIcon');
    var hamburgerCloseIcon = document.getElementById('hamburgerCloseIcon');
    var dropdown     = document.getElementById('hamburgerDropdown');
    var dropdownOpen = false;

    function measure() {
        fullNav.style.display = 'flex';
        hamburgerRow.style.display = 'none';

        var headerBar  = fullNav.closest('.flex.items-center.justify-between');
        var availWidth = headerBar.clientWidth;
        var logoEl     = headerBar.querySelector('a');
        var logoWidth  = logoEl.offsetWidth;
        var available  = availWidth - logoWidth - 32;
        var navNeeded  = fullNav.scrollWidth;

        if (navNeeded <= available) {
            fullNav.style.display = 'flex';
            hamburgerRow.style.display = 'none';
        } else {
            fullNav.style.display  = 'none';
            hamburgerRow.style.display = 'flex';
        }
    }

    function toggleDropdown() {
        dropdownOpen = !dropdownOpen;
        dropdown.classList.toggle('hidden', !dropdownOpen);
        hamburgerIcon.classList.toggle('hidden', dropdownOpen);
        hamburgerCloseIcon.classList.toggle('hidden', !dropdownOpen);
    }

    hamburgerBtn.addEventListener('click', toggleDropdown);

    document.addEventListener('click', function(e) {
        if (dropdownOpen && !hamburgerBtn.contains(e.target) && !dropdown.contains(e.target)) {
            dropdownOpen = false;
            dropdown.classList.add('hidden');
            hamburgerIcon.classList.remove('hidden');
            hamburgerCloseIcon.classList.add('hidden');
        }
    });

    measure();
    window.addEventListener('resize', measure);
})();
</script>

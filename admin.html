<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Portal - The Greek Directory</title>
    <link rel="icon" href="https://social.thegreekdirectory.org/Logo2.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <link rel="stylesheet" href="css/admin.css">
    // Copyright (C) The Greek Directory, 2025-2026. All rights reserved. This source code is proprietary and no part may not be used, reproduced, or distributed without written permission from The Greek Directory. Unauthorized use, copying, modification, or distribution of this code will result in legal action to the fullest extent permitted by law.
</head>
<body class="bg-gray-50">
    <!-- Login Page -->
    <div id="loginPage" class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <img src="https://social.thegreekdirectory.org/Logo2.png" alt="The Greek Directory" class="h-16 w-auto mx-auto mb-4">
                <h1 class="text-3xl font-bold">Admin Portal</h1>
                <p class="text-blue-100 mt-2">Enter your Personal Access Token to access</p>
            </div>
            
            <div class="auth-body">
                <div id="authMessage" class="hidden"></div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Personal Access Token</label>
                        <input type="password" id="githubToken" class="tgd-input" placeholder="Type here..." autocomplete="off">
                    </div>
                    <button onclick="handleAdminLogin()" class="tgd-button-primary">
                        Access Admin Portal
                    </button>
                </div>
                
                <p class="text-center text-sm text-gray-600 mt-4">
                    If you are here by mistake, <a href="https://thegreekdirectory.org" class="text-blue-600 hover:underline">click here</a> to go to the Home page.
                </p>
            </div>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboardPage" class="hidden">
        <header class="bg-white shadow-sm border-b sticky top-0 z-50">
            <div class="px-6 py-4 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <img src="https://social.thegreekdirectory.org/Logo2.png" alt="The Greek Directory" class="h-12 w-auto">
                    <h1 class="text-xl font-bold" style="color: #055193;">Admin Portal</h1>
                </div>
                <button id="logoutBtn" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200">Logout</button>
            </div>
        </header>

        <div class="max-w-7xl mx-auto px-4 py-6">
            <div class="mb-6 flex gap-3 flex-wrap">
                <button id="newListingBtn" class="px-4 py-2 text-white rounded-lg font-medium" style="background-color: #055193;">+ New Listing</button>
                <input type="text" id="adminSearch" placeholder="Search listings..." 
                    class="px-4 py-2 border border-gray-300 rounded-lg flex-1 min-w-[200px]" 
                    oninput="renderTable()">
                <button id="refreshBtn" class="px-4 py-2 bg-gray-200 text-gray-900 rounded-lg font-medium">ðŸ”„ Refresh</button>
                <button id="uploadCSVBtn" class="px-4 py-2 bg-green-600 text-white rounded-lg font-medium">ðŸ“¤ Upload CSV</button>
            </div>

            <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="text-left py-3 px-4 font-semibold text-gray-900">ID</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-900">Status</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-900">Tier</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-900">Business Name</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-900">Category</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-900">Location</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-900">Last Updated</th>
                                <th class="text-right py-3 px-4 font-semibold text-gray-900">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="listingsTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Edit Modal -->
    <div id="editModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto">
        <div class="bg-white rounded-lg max-w-4xl w-full my-8">
            <div class="p-6 border-b flex items-center justify-between">
                <h2 id="modalTitle" class="text-2xl font-bold text-gray-900">Edit Listing</h2>
                <button id="closeModal" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
            </div>
            <div class="p-6 max-h-[70vh] overflow-y-auto">
                <div class="space-y-6" id="editFormContent"></div>
            </div>
            <div class="p-6 border-t flex justify-end gap-3">
                <button id="cancelEdit" class="px-6 py-2 bg-gray-200 text-gray-900 rounded-lg font-medium">Cancel</button>
                <button id="saveEdit" class="px-6 py-2 text-white rounded-lg font-medium" style="background-color: #055193;">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Analytics Modal -->
    <div id="analyticsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col">
            <div class="flex items-center justify-between p-6 border-b">
                <h2 class="text-2xl font-bold text-gray-900">Analytics for <span id="analyticsBusinessName"></span></h2>
                <button id="closeAnalytics" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
            </div>
            
            <div class="flex border-b overflow-x-auto">
                <div class="analytics-tab active" data-tab="overview" onclick="switchAnalyticsTab('overview')">Overview</div>
                <div class="analytics-tab" data-tab="today" onclick="switchAnalyticsTab('today')">Today</div>
                <div class="analytics-tab" data-tab="yesterday" onclick="switchAnalyticsTab('yesterday')">Yesterday</div>
                <div class="analytics-tab" data-tab="week" onclick="switchAnalyticsTab('week')">Past Week</div>
                <div class="analytics-tab" data-tab="month" onclick="switchAnalyticsTab('month')">Past 30 Days</div>
                <div class="analytics-tab" data-tab="alltime" onclick="switchAnalyticsTab('alltime')">All Time</div>
            </div>
            
            <div class="flex-1 overflow-y-auto p-6">
                <div class="flex items-center justify-between mb-6">
                    <div class="text-sm text-gray-600">Last updated: <span id="analyticsLastUpdated"></span></div>
                    <button id="refreshAnalytics" class="px-4 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200">ðŸ”„ Refresh</button>
                </div>
                
                <div id="analyticsContent"></div>
            </div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div id="deleteModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg max-w-md w-full p-6">
            <h2 class="text-2xl font-bold text-red-600 mb-4">Delete Listing</h2>
            <p class="text-gray-700 mb-4">Are you sure you want to delete <strong id="deleteBusinessName"></strong>?</p>
            <p class="text-gray-700 mb-4">Type <strong>DELETE</strong> to confirm:</p>
            <input type="text" id="deleteConfirmInput" class="w-full px-4 py-2 border border-gray-300 rounded-lg mb-4" placeholder="Type DELETE">
            <div class="flex gap-3">
                <button id="cancelDelete" class="flex-1 px-4 py-2 bg-gray-200 text-gray-900 rounded-lg font-medium">Cancel</button>
                <button id="confirmDelete" class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg font-medium">Confirm Delete</button>
            </div>
        </div>
    </div>

    <!-- CSV Upload Modal -->
    <div id="csvModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg max-w-2xl w-full p-6">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">Upload CSV File</h2>
            <p class="text-gray-600 mb-4">Select a CSV file to bulk import listings. The file must include the required columns.</p>
            
            <input type="file" id="csvFileInput" accept=".csv" class="w-full px-4 py-2 border border-gray-300 rounded-lg mb-4">
            
            <div id="csvPreview" class="hidden mb-4">
                <h3 class="font-semibold mb-2">Preview:</h3>
                <div class="bg-gray-50 p-4 rounded max-h-64 overflow-auto text-sm">
                    <pre id="csvPreviewContent"></pre>
                </div>
            </div>
            
            <div class="flex gap-3">
                <button id="cancelCSV" class="flex-1 px-4 py-2 bg-gray-200 text-gray-900 rounded-lg font-medium">Cancel</button>
                <button id="uploadCSV" class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg font-medium">Upload & Import</button>
            </div>
        </div>
    </div>

    <!-- Magic Link Modal -->
    <div id="magicLinkModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg max-w-md w-full p-6">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">Send Magic Link</h2>
            <p class="text-gray-700 mb-4">Are you sure you want to send a magic link to <strong id="magicLinkEmail"></strong>?</p>
            <p class="text-gray-700 mb-4">Type <strong>CONFIRM</strong> to proceed:</p>
            <input type="text" id="magicLinkConfirmInput" class="w-full px-4 py-2 border border-gray-300 rounded-lg mb-4" placeholder="Type CONFIRM">
            <div class="flex gap-3">
                <button id="cancelMagicLink" class="flex-1 px-4 py-2 bg-gray-200 text-gray-900 rounded-lg font-medium">Cancel</button>
                <button id="confirmMagicLink" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium">Send Link</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/admin.js"></script>
</body>
</html>
